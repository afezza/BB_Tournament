<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <title>Tournment management</title>
</head>

<body>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <script src="manage-tournament.js"></script>

    <script>
        var tournament = {};

        var dataToSend = {
            id: "",
            arbiter_key: "",
            command: "",
        };

        async function downloadWebAppData() {

            const urlParams = new URLSearchParams(window.location.search);
            let i = 0;
            urlParams.forEach((value, key) => {
                // console.log(key + ": " + value)
                if (i === 0) {
                    dataToSend["id"] = key;
                } else if (i === 1) {
                    dataToSend["arbiter_key"] = key;
                }
                i += 1;
            });
            dataToSend["command"] = "retrieve_tournament_data";

            // Make the POST request using fetch
            response = await fetch('https://d2t6tpvmul5epr.cloudfront.net/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dataToSend),
            })
            data = await response.json();
            if (data.hasOwnProperty("location")) {
                window.location.replace(data["location"]);
            }

            // Parse received arrays to create iterable objects 
            tournament = data["tournament"];
            tournament["players"] = JSON.parse(data["tournament"]["players"]);
            tournament["rounds"] = JSON.parse(data["tournament"]["rounds"]);
            tournament["playoff"] = JSON.parse(data["tournament"]["playoff"]);
        }

        function showView(view) {
            mainBody = document.getElementById("main-body");
            mainBody.removeChild(mainBody.children[0]);
            mainBody.appendChild(view);
        }

        // webapp main
        document.addEventListener("DOMContentLoaded", async function () {
            // Download all the required data
            await downloadWebAppData();

            // Load the main page
            loadManagePage();
        });

    </script>

    <div class="container-fluid" style="margin-top:56px; padding-bottom: 20px;" id="main-body">
        <div class="container"></div>
    </div>

</body>

</html>
